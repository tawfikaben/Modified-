<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>دار حسنا - مطعم مغربي أصيل</title>
  <!-- خطوط عربية -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Lateef:wght@400;600&display=swap" rel="stylesheet">
  <!-- أيقونات زخرفية -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* أنماط مغربية شعبية أصيلة */
    :root {
      --color-primary: #9c2e2e; /* أحمر مغربي */
      --color-secondary: #e67e22; /* برتقالي مغربي */
      --color-accent: #daa520; /* ذهبي تقليدي */
      --color-text: #5d4037; /* بني خشبي */
      --color-light: #f8f1e9; /* كريمي */
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Lateef', cursive;
      background-color: var(--color-light);
      background-image: url('https://www.toptal.com/designers/subtlepatterns/uploads/morocco-blue.png');
      color: var(--color-text);
      margin: 0;
      padding: 0;
      font-size: 18px;
      line-height: 1.6;
    }
    
    .container {
      width: 100%;
      margin: 0 auto;
      background-color: rgba(255, 255, 255, 0.95);
      padding: 15px;
      border-radius: 0;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border: none;
      position: relative;
      overflow: hidden;
    }
    
    /* عناوين مغربية */
    h1, h2, h3 {
      color: var(--color-primary);
      text-align: center;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      font-family: 'Amiri', serif;
    }
    
    h1 {
      margin: 10px 0;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 1px;
    }
    
    .subtitle {
      text-align: center;
      color: var(--color-text);
      margin-bottom: 20px;
      font-size: 1.4rem;
      position: relative;
      font-style: italic;
    }
    
    /* بطاقات الأصناف */
    .menu-section {
      margin-bottom: 30px;
      background-color: rgba(255, 248, 240, 0.7);
      padding: 15px;
      border-radius: 5px;
      border: 2px dashed var(--color-secondary);
    }
    
    .menu-section h3 {
      position: relative;
      padding-bottom: 10px;
      margin-bottom: 20px;
      color: var(--color-primary);
      font-size: 1.8rem;
    }
    
    .menu-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 5px;
      transition: all 0.3s;
      cursor: pointer;
      border: 1px solid transparent;
      flex-wrap: wrap;
    }
    
    .menu-item:hover {
      transform: translateX(-5px);
      background-color: rgba(255, 248, 240, 0.9);
      border: 1px solid var(--color-secondary);
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    
    .menu-item.selected {
      background-color: rgba(156, 46, 46, 0.1);
      border: 1px solid var(--color-primary);
      transform: translateX(-5px);
    }
    
    .item-name {
      font-weight: bold;
      color: var(--color-primary);
      font-size: 1.3rem;
      width: 70%;
    }
    
    .item-price {
      color: var(--color-primary);
      font-weight: bold;
      font-size: 1.3rem;
      width: 30%;
      text-align: left;
    }
    
    .item-desc {
      font-size: 1.1rem;
      color: var(--color-text);
      margin-top: 5px;
      width: 100%;
    }
    
    /* النموذج */
    form {
      background-color: rgba(255, 248, 240, 0.9);
      padding: 20px;
      border-radius: 5px;
      margin-top: 30px;
      border: 2px solid var(--color-primary);
    }
    
    label {
      display: block;
      margin: 15px 0 8px;
      font-weight: bold;
      color: var(--color-primary);
      font-size: 1.2rem;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1.1rem;
      font-family: 'Lateef', cursive;
    }
    
    button {
      background-color: var(--color-primary);
      color: white;
      border: none;
      padding: 15px;
      margin-top: 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.3rem;
      width: 100%;
      transition: all 0.3s;
      font-weight: bold;
      font-family: 'Amiri', serif;
    }
    
    button:hover {
      background-color: var(--color-secondary);
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    }
    
    .confirmation {
      display: none;
      background-color: rgba(212, 237, 218, 0.9);
      color: #155724;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      text-align: center;
      border: 1px solid #c3e6cb;
      font-size: 1.2rem;
    }
    
    .commande-item {
      background-color: rgba(240, 240, 240, 0.9);
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      border-right: 4px solid var(--color-secondary);
    }
    
    .remove-item {
      color: var(--color-primary);
      cursor: pointer;
      font-weight: bold;
      margin-right: 10px;
      font-size: 1.3rem;
    }
    
    #listeCommandes {
      margin-top: 20px;
    }
    
    .total {
      font-weight: bold;
      text-align: left;
      margin-top: 15px;
      font-size: 1.5rem;
      color: var(--color-primary);
    }
    
    /* زخارف مغربية */
    .moroccan-decoration {
      text-align: center;
      margin: 20px 0;
      color: var(--color-secondary);
      font-size: 1.5rem;
      letter-spacing: 10px;
    }
    
    #selected-item {
      margin: 15px 0;
      padding: 12px;
      background-color: rgba(156, 46, 46, 0.1);
      border-radius: 5px;
      display: none;
      font-size: 1.1rem;
    }
    
    /* تحسينات للشاشات الصغيرة جدًا */
    @media (max-width: 480px) {
      body {
        font-size: 16px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .subtitle {
        font-size: 1.2rem;
      }
      
      .menu-section h3 {
        font-size: 1.5rem;
      }
      
      .item-name, .item-price {
        font-size: 1.1rem;
      }
      
      .item-desc {
        font-size: 1rem;
      }
      
      button {
        font-size: 1.1rem;
        padding: 12px;
      }
    }
    
    /* تحسينات للشاشات الكبيرة */
    @media (min-width: 768px) {
      .container {
        max-width: 750px;
        padding: 30px;
        margin: 20px auto;
        border-radius: 5px;
        border: 3px solid var(--color-primary);
      }
      
      h1 {
        font-size: 3rem;
      }
      
      .menu-item {
        flex-wrap: nowrap;
      }
      
      .item-name {
        width: auto;
      }
      
      .item-price {
        width: auto;
        text-align: right;
      }
    }
    
    /* أنماط إضافية للتحميل */
    .loading {
      text-align: center;
      padding: 20px;
      font-size: 1.2rem;
      color: var(--color-text);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="moroccan-decoration">✻ ❁ ✻ ❁ ✻</div>
    
    <h1>دار حسنا</h1>
    <p class="subtitle">مطبخ مغربي أصيل منذ 1985</p>
    
    <h2>قائمتنا الشهية</h2>
    
    <!-- سيتم تعبئة القائمة ديناميكياً هنا -->
    <div id="menuContainer">
      <div class="loading">جاري تحميل القائمة...</div>
    </div>
    
    <div class="moroccan-decoration">❁ ✻ ❁ ✻ ❁</div>
    
    <form id="commandeForm">
      <h2>تقديم الطلب</h2>
      
      <label for="table">رقم الطاولة:</label>
      <input type="number" id="table" min="1" required>
      
      <label for="notes">ملاحظة:</label>
      <input type="text" id="notes" placeholder="أي ملاحظات إضافية حول الطلب">
      
      <div id="listeCommandes"></div>
      
      <div class="total" id="totalCommande">المجموع: 0 درهم</div>
      
      <button type="submit">
        تأكيد الطلب
      </button>
      
      <div id="confirmation" class="confirmation"></div>
    </form>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDpSF4J0bsd6T0ImMpse0KQQRADaxiYUQw",
      authDomain: "darhassna-484c3.firebaseapp.com",
      databaseURL: "https://darhassna-484c3-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "darhassna-484c3",
      storageBucket: "darhassna-484c3.firebasestorage.app",
      messagingSenderId: "141393162149",
      appId: "1:141393162149:web:0717227eac221f5ddfc24c"
    };

    // Initialiser Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // متغيرات لتخزين الطلبات
    let commandes = [];
    let total = 0;

    // دالة لتحميل وعرض القائمة من Firebase
    function loadAndDisplayMenu() {
      database.ref('menu').on('value', (snapshot) => {
        const menuData = snapshot.val();
        const menuContainer = document.getElementById('menuContainer');
        
        if (menuData && menuData.length > 0) {
          menuContainer.innerHTML = '';
          
          menuData.forEach(section => {
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'menu-section';
            sectionDiv.innerHTML = `<h3>${section.section}</h3>`;
            
            section.items.forEach(item => {
              const itemDiv = document.createElement('div');
              itemDiv.className = 'menu-item';
              itemDiv.setAttribute('data-plat', item.plat);
              itemDiv.setAttribute('data-prix', item.prix);
              itemDiv.innerHTML = `
                <div>
                  <div class="item-name">${item.plat}</div>
                  <div class="item-desc">${item.description}</div>
                </div>
                <div class="item-price">${item.prix} درهم</div>
              `;
              sectionDiv.appendChild(itemDiv);
            });
            
            menuContainer.appendChild(sectionDiv);
          });
          
          // إعادة ربط أحداث النقر على العناصر
          attachMenuItemsEvents();
        } else {
          menuContainer.innerHTML = '<div class="loading">لا توجد عناصر في القائمة حالياً</div>';
        }
      });
    }

    // دالة لربط أحداث النقر على عناصر القائمة
    function attachMenuItemsEvents() {
      document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', function() {
          // إزالة التحديد من جميع الأطباق
          document.querySelectorAll('.menu-item').forEach(i => {
            i.classList.remove('selected');
          });
          
          // إضافة التحديد للطبق المختار
          this.classList.add('selected');
          
          // إضافة الطبق المختار إلى الطلب مباشرة
          const plat = this.getAttribute('data-plat');
          const prix = parseInt(this.getAttribute('data-prix'));
          
          // إضافة إلى قائمة الطلبات
          commandes.push({
            plat: plat,
            quantite: 1, // كمية افتراضية
            prix: prix
          });
          
          // تحديث العرض
          afficherCommandes();
          
          // إزالة التحديد بعد إضافة الطبق
          setTimeout(() => {
            this.classList.remove('selected');
          }, 300);
        });
      });
    }

    // عرض قائمة الطلبات
    function afficherCommandes() {
      const listeCommandes = document.getElementById('listeCommandes');
      listeCommandes.innerHTML = '';
      total = 0;
      
      commandes.forEach((commande, index) => {
        const sousTotal = commande.quantite * commande.prix;
        total += sousTotal;
        
        const div = document.createElement('div');
        div.className = 'commande-item';
        div.innerHTML = `
          <div>
            ${commande.quantite} × ${commande.plat} (${commande.prix} درهم)
          </div>
          <div>
            ${sousTotal} درهم 
            <span class="remove-item" data-index="${index}">×</span>
            <span class="change-quantity" data-index="${index}" data-action="increase">+</span>
            <span class="change-quantity" data-index="${index}" data-action="decrease">-</span>
          </div>
        `;
        listeCommandes.appendChild(div);
      });
      
      // تحديث المجموع الكلي
      document.getElementById('totalCommande').textContent = `المجموع: ${total} درهم`;
      
      // إضافة أحداث لحذف الأصناف
      document.querySelectorAll('.remove-item').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          commandes.splice(index, 1);
          afficherCommandes();
        });
      });
      
      // إضافة أحداث لتغيير الكمية
      document.querySelectorAll('.change-quantity').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          const action = this.getAttribute('data-action');
          
          if (action === 'increase') {
            commandes[index].quantite += 1;
          } else if (action === 'decrease' && commandes[index].quantite > 1) {
            commandes[index].quantite -= 1;
          }
          
          afficherCommandes();
        });
      });
    }

    // عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', function() {
      // تحميل وعرض القائمة من Firebase
      loadAndDisplayMenu();
      
      // معالجة إرسال النموذج
      document.getElementById('commandeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const table = document.getElementById('table').value;
        const notes = document.getElementById('notes').value;
        
        if (!table || commandes.length === 0) {
          alert('الرجاء تحديد رقم الطاولة وإضافة طلب واحد على الأقل');
          return;
        }
        
        // إرسال البيانات إلى Firebase
        database.ref('commandes').push({
          table: table,
          notes: notes,
          commandes: commandes,
          total: total,
          timestamp: firebase.database.ServerValue.TIMESTAMP,
          statut: 'في الانتظار'
        });
        
        // عرض رسالة التأكيد
        const confirmation = document.getElementById('confirmation');
        confirmation.textContent = `تم تأكيد الطلب للطاولة ${table}! المجموع: ${total} درهم` + 
                                 (notes ? `\nملاحظة: ${notes}` : '');
        confirmation.style.display = 'block';
        
        // إعادة تعيين النموذج
        commandes = [];
        afficherCommandes();
        document.getElementById('table').value = '';
        document.getElementById('notes').value = '';
        
        // إخفاء رسالة التأكيد بعد 5 ثواني
        setTimeout(() => {
          confirmation.style.display = 'none';
        }, 5000);
      });
    });
  </script>
</body>
</html>
